# Bloomie Agent Deployment Playbook

**Last Updated:** 2026-02-14 01:49 UTC  
**Reference Deployment:** Johnathon's instance (Bloomie-YES)  
**Status:** Fully operational and tested

---

## 1. PREREQUISITES

### Credentials Required
All credentials must be stored in `/data/secrets/` and backed up to Google Drive.

- **Railway API Token** (account-level, NOT project-level)
  - File: `/data/secrets/railway-api-token.txt`
  - Scope: Deploy, SSH, logs access
  - How to get: Railway dashboard ‚Üí Account Settings ‚Üí Tokens

- **GitHub PAT** (Personal Access Token)
  - File: `/data/secrets/github-pat.txt`
  - Scopes: `repo`, `workflow`
  - How to get: GitHub ‚Üí Settings ‚Üí Developer Settings ‚Üí Personal Access Tokens

- **Google Drive OAuth2 Credentials**
  - File: `/data/workspace/drive-delivery/config.json`
  - Contents: `clientId`, `clientSecret`, `folderId`
  - How to get: Google Cloud Console ‚Üí OAuth2 client credentials
  - Folder: Bloomie Deliveries (shared folder for all agents)

- **Google Drive Refresh Token**
  - File: `/data/workspace/drive-delivery/.drive-tokens.json`
  - Generated by: `node scripts/oauth-setup.js` (one-time manual auth)
  - Scope: `https://www.googleapis.com/auth/drive.file`

- **Setup Password**
  - Set as environment variable: `SETUP_PASSWORD=openclaw`
  - Used for: `/setup` page and import endpoint auth

---

## 2. STEP-BY-STEP DEPLOYMENT

### 2.1 Create Railway Project

Use Railway GraphQL API or dashboard. Project must have:
- GitHub integration enabled
- Linked to `kimberlyflowers/clawdbot-railway-template` repo
- Persistent volume mounted at `/data` (survives restarts)

**Key IDs to save:**
- Project ID: `c9af8ed1-b3ef-4ba0-93c2-472edb5033f7` (Bloomie-YES example)
- Service ID: `d40d3b8c-f23a-4050-acff-e9c637537965`
- Environment ID: `29ca9097-9f1d-41a3-8435-5a868e0b6a95`

### 2.2 Set Environment Variables

In Railway ‚Üí Variables, set EXACTLY these:

```
OPENCLAW_STATE_DIR=/data/.clawdbot
  ‚Üí Where OpenClaw stores config, tokens, sessions

OPENCLAW_WORKSPACE_DIR=/data/workspace
  ‚Üí Where agent identity files and skills live

OPENCLAW_GATEWAY_TOKEN=[generate-32-byte-hex]
  ‚Üí Auth token for Control UI. Keep stable across restarts.
  ‚Üí Generate: openssl rand -hex 32

SETUP_PASSWORD=openclaw
  ‚Üí Password for /setup page and import endpoint

NODE_ENV=production
  ‚Üí Minimize logs, optimize runtime

INTERNAL_GATEWAY_PORT=18789
  ‚Üí Where gateway listens internally (don't change)

INTERNAL_GATEWAY_HOST=127.0.0.1
  ‚Üí Loopback only, not public (don't change)
```

### 2.3 Deploy and Wait

- Trigger deploy from GitHub commit or via Railway dashboard
- Expected time: 5-7 minutes for first build
- **Verify:** `curl https://[INSTANCE_URL]/setup/healthz` returns `{"ok":true}`

### 2.4 Configure via Setup Endpoint

**Submit OpenClaw config:**

```bash
curl -X POST https://[INSTANCE_URL]/setup/api/config/raw \
  -H "Authorization: Basic $(echo -n 'setup:openclaw' | base64)" \
  -H "Content-Type: application/json" \
  -d '{"content": "[full openclaw.json as string]"}'
```

Example `openclaw.json`:
```json
{
  "meta": {
    "lastTouchedVersion": "2026.2.10",
    "lastTouchedAt": "2026-02-14T00:00:00Z"
  },
  "wizard": {
    "lastRunMode": "local"
  },
  "agents": {
    "defaults": {
      "model": {
        "primary": "anthropic/claude-haiku-4-5"
      },
      "workspace": "/data/workspace"
    }
  },
  "gateway": {
    "port": 18789,
    "mode": "local",
    "bind": "loopback",
    "auth": {
      "mode": "token",
      "token": "[OPENCLAW_GATEWAY_TOKEN]"
    }
  }
}
```

Gateway will restart after config is submitted.

### 2.5 Authenticate in Control UI

1. Visit `https://[INSTANCE_URL]/`
2. Prompted for "Gateway Token"
3. Enter the token from `OPENCLAW_GATEWAY_TOKEN` env var
4. Click **Connect** in Overview tab
5. Should show "Connected" with agent status

---

## 3. PUSHING FILES VIA IMPORT ENDPOINT

### ‚ö†Ô∏è CRITICAL: TAR STRUCTURE

The tar MUST be created **relative to `/data/`** ‚Äî this is the #1 mistake.

**WRONG (files land in /data/data/):**
```bash
tar -czf backup.tar.gz data/workspace/file.txt
# Extracts to: /data/data/workspace/file.txt ‚ùå
```

**RIGHT (files land in /data/workspace/):**
```bash
cd /data
tar -czf /tmp/backup.tar.gz workspace/file.txt
# Extracts to: /data/workspace/file.txt ‚úÖ
```

### Push Command

```bash
SETUP_PASSWORD="openclaw"
AUTH=$(echo -n ":$SETUP_PASSWORD" | base64)

curl -s -X POST https://[INSTANCE_URL]/setup/import \
  -H "Authorization: Basic $AUTH" \
  -H "Content-Type: application/gzip" \
  --data-binary @backup.tar.gz
```

Response: `OK - imported backup into /data and restarted gateway.`

**Verify files landed:**
- Wait 10-15 seconds for gateway restart
- Check from instance: `ls -la /data/workspace/IDENTITY.md`

---

## 4. IDENTITY FILES TO PUSH

### Push in this order:

**1. Workspace identity (required)**
```bash
cd /data && tar -czf /tmp/identity.tar.gz \
  workspace/IDENTITY.md \
  workspace/SOUL.md \
  workspace/AGENTS.md \
  workspace/USER.md \
  workspace/TOOLS.md \
  workspace/HEARTBEAT.md
```

Then push via import endpoint (see section 3).

**2. Drive-delivery skill (required for file delivery)**
```bash
cd /data && tar -czf /tmp/drive-skill.tar.gz \
  workspace/drive-delivery/
```

Push via import endpoint. Excludes `node_modules` ‚Äî they install fresh.

**3. OAuth token (required for drive-delivery to work)**
```bash
cd /data && tar -czf /tmp/oauth-token.tar.gz \
  workspace/drive-delivery/.drive-tokens.json
```

Push via import endpoint. **This is a separate push** after drive-delivery folder.

### File Contents (Customize Per Agent)

**IDENTITY.md:**
```markdown
# IDENTITY.md - Who Am I?

- **Name:** [Agent name]
- **Creature:** AI [role] ‚Äî [description]
- **Vibe:** [tone and style]
- **Emoji:** [representative emoji]
```

**SOUL.md:** Copy from Jaden's instance, customize the role and task protocol.

**USER.md:** 
```markdown
- **Name:** Kimberly
- **Organization:** [Client/project name]
- **Role:** Your employer/coordinator
- **Notes:** Follow SOUL.md strictly.
```

**Johnathon example:**
- IDENTITY: "Johnathon, AI operations agent, üìã"
- SOUL: Operations-focused task protocol
- USER: "Youth Empowerment School"

---

## 5. MISTAKES MADE ‚Äî DO NOT REPEAT

### 5.1 Git/Code Mistakes
- ‚ùå DO NOT modify `package.json` on live instance
  - Railway syncs from GitHub; changes get overwritten
  - Change source files ‚Üí git commit ‚Üí push ‚Üí Railway redeploy

- ‚ùå DO NOT commit credentials to GitHub
  - Store in `/data/secrets/` only
  - Add to `.gitignore`

### 5.2 Token/Auth Mistakes
- ‚ùå DO NOT use project-level Railway tokens for account-level operations
  - Results: "Unauthorized" errors
  - Fix: Use account-level API token

- ‚ùå DO NOT expect Railway SSH with standard SSH keys
  - Railway uses WebSocket protocol via CLI only
  - `railway ssh` command requires `RAILWAY_TOKEN` env var
  - Standard SSH key injection doesn't work

### 5.3 Configuration Mistakes
- ‚ùå DO NOT put API keys in `openclaw.json` config file
  - Auth tokens go in: `/data/.clawdbot/agents/main/agent/auth-profiles.json`
  - Config is for settings, NOT secrets

- ‚ùå DO NOT enter gateway token in Config tab
  - Goes in: **Overview tab ‚Üí "Gateway Token" field**
  - Config tab is for openclaw.json settings only

### 5.4 File Deployment Mistakes
- ‚ùå DO NOT create tar with `data/workspace/...` path structure
  - Causes double-nesting: `/data/data/workspace/...`
  - Fix: Create tar from `/data` directory (see section 3)

- ‚ùå DO NOT assume import "OK" response means files are in right place
  - Response is misleading
  - **Always verify:** `ls -la /data/workspace/[filename]` from the instance

- ‚ùå DO NOT push large tarballs (>100MB)
  - Excludes: node_modules, .git, archives
  - Use focused backups for each component

### 5.5 Process Mistakes
- ‚ùå DO NOT lose credentials to context compaction
  - Save immediately to `/data/secrets/`
  - Backup to Google Drive after each deployment
  - Document in DEPLOYMENT-PLAYBOOK.md

- ‚ùå DO NOT run init scripts expecting them to execute
  - They only run if `server.js` explicitly calls them
  - Check source before assuming auto-execution

- ‚ùå DO NOT test with manual browser OAuth flows
  - Use saved `.drive-tokens.json` refresh token instead
  - One-time setup; reuse token across agents

---

## 6. VERIFICATION CHECKLIST

After deployment completes, verify in this order:

- [ ] **Instance URL loads**: `curl https://[URL]/` ‚Üí HTTP 200 (not setup page)
- [ ] **Wrapper responsive**: `curl https://[URL]/setup/healthz` ‚Üí `{"ok":true}`
- [ ] **Login prompt shows**: Visit dashboard, asks for "Gateway Token"
- [ ] **Gateway token accepted**: Enter token, click Connect ‚Üí shows "Connected"
- [ ] **Agent responds**: Send message in Chat ‚Üí gets response
- [ ] **Identity correct**: Check `/data/workspace/IDENTITY.md` on instance
- [ ] **Skill available**: Run `ls /data/workspace/drive-delivery/`
- [ ] **OAuth token present**: Run `ls /data/workspace/drive-delivery/.drive-tokens.json`
- [ ] **Drive-delivery test passes**: Run `node /data/workspace/drive-delivery/test.js`
- [ ] **File uploads work**: Run `node -e "const {uploadToDrive} = require('./scripts/upload.js'); uploadToDrive('./test.txt', 'test.txt');"`
- [ ] **File in Drive**: Check Bloomie Deliveries folder for uploaded test file
- [ ] **Credentials saved**: Check `/data/secrets/` has all required tokens
- [ ] **Backup created**: Tar.gz of full workspace in Google Drive

---

## 7. BLOOMIE LOGO SWAP (PENDING)

### ‚ö†Ô∏è STATUS: NOT YET IMPLEMENTED ON JOHNATHON'S INSTANCE

The Control UI header still shows "OpenClaw" instead of "üå∏ Bloomie". This needs to be done for Johnathon and all future agents.

### How to Implement

The logo swap is a **text-only branding change** in the Control UI source code:

**Location:** `/openclaw/ui/src/ui/app.ts`

**What to change:**
Search for the app name constant and replace:
```typescript
// BEFORE:
const APP_NAME = "OpenClaw";

// AFTER:
const APP_NAME = "üå∏ Bloomie";
```

Also check `app-render.ts` for any hardcoded "OpenClaw" strings and replace with "Bloomie".

### Implementation via Git Commit

1. Clone the Railway template repo locally
2. Edit the source files (see locations above)
3. Commit and push to GitHub:
   ```bash
   git commit -m "refactor: Bloomie logo swap - OpenClaw ‚Üí üå∏ Bloomie"
   git push origin main
   ```
4. Railway auto-detects the push and rebuilds the image
5. Deploy completes (~5-7 minutes)
6. Logo is now "üå∏ Bloomie" in Control UI header

### Alternative: CSS Branding (Future)

For a more complete rebrand (colors, gradients, full theme), see:
- File: `/openclaw/ui/src/styles/base.css`
- Customize the 67 CSS custom properties (--bg, --accent, --primary, etc.)
- Use Bloomie colors: Peach #F4A261, Coral #E76F8B

**Note:** Full CSS rebranding requires Control UI rebuild (Phase 2+ of original plan). For now, text-only swap is sufficient.

### TODO for Future Deployments

- [ ] Add logo swap to GitHub template before creating new agent instance
- [ ] Or: Create a separate "bloomie-branding" branch for quick deployment
- [ ] Or: Automate via deployment script that patches source before build

**Current Status:**
- Jaden's instance: Has Bloomie branding (from earlier logo swap commits)
- Johnathon's instance: Still shows OpenClaw (needs git commit + rebuild)

---

## 8. ROLLBACK

If deployment breaks and needs restart:

### 8.1 Via Railway Dashboard
1. Go to Deployments
2. Click latest deployment
3. Select **Restart** (not Redeploy ‚Äî doesn't rebuild)

### 8.2 Via Railway CLI
```bash
export RAILWAY_TOKEN=[account-token]
railway restart --service [SERVICE_ID] --force
```

### 8.3 Worst Case: Revert Start Command
If app won't start, change Railway start command temporarily:
```
node /app/src/server.js
```

Then manually re-import files via setup endpoint once it's running.

### ‚ö†Ô∏è NEVER
- Delete the `/data` volume (contains all agent memory)
- Nuke the workspace directory
- Wipe credentials without backup

---

## 9. CREDENTIALS STORED

All credentials must be saved here immediately after generation:

```
/data/secrets/
‚îú‚îÄ‚îÄ railway-api-token.txt          ‚Üí Account-level Railway API token
‚îú‚îÄ‚îÄ github-pat.txt                 ‚Üí GitHub Personal Access Token
‚îú‚îÄ‚îÄ setup-password.txt             ‚Üí Setup page password
‚îú‚îÄ‚îÄ anthropic-key.txt              ‚Üí Anthropic API key (for reference)
‚îî‚îÄ‚îÄ johnathon-railway-key          ‚Üí SSH private key (if using SSH)
    ‚îî‚îÄ‚îÄ johnathon-railway-key.pub  ‚Üí SSH public key

/data/workspace/
‚îú‚îÄ‚îÄ drive-delivery/
‚îÇ   ‚îú‚îÄ‚îÄ config.json                ‚Üí Google OAuth2 clientId, clientSecret, folderId
‚îÇ   ‚îî‚îÄ‚îÄ .drive-tokens.json         ‚Üí Refresh token (critical for uploads)
```

**Backup all to Google Drive immediately after each deployment.**

---

## 10. FUTURE AGENTS - USE THIS TEMPLATE

For each new agent (Johnathon, future agents):

1. **Create Railway project** with persistent /data volume
2. **Set env vars** (copy from section 2.2)
3. **Wait for deploy** and verify healthz
4. **Push config** via setup endpoint (section 2.4)
5. **Push identity files** via import endpoint (section 4)
6. **Push drive-delivery** skill and OAuth token
7. **Verify checklist** (section 6)
8. **Save credentials** to /data/secrets/ (section 8)
9. **Backup to Drive** (this playbook included)

---

## 11. REFERENCE LINKS

**Deployments Completed:**
- Jaden's instance: lucid-respect (main agent)
- Johnathon's instance: Bloomie-YES (operations agent)

**Shared Resources:**
- GitHub repo: https://github.com/kimberlyflowers/clawdbot-railway-template
- Bloomie Deliveries folder: https://drive.google.com/drive/folders/1u4bjqh92rl9xJHC5vmP69fgDq_beNsF1
- OpenClaw docs: https://docs.openclaw.ai

**This Playbook:**
- Saved to: `/data/workspace/DEPLOYMENT-PLAYBOOK.md`
- Backed up to: Google Drive (see section 8)

---

**Created:** 2026-02-14 01:49 UTC  
**By:** Jaden (Bloomie)  
**Version:** 1.0  
**Status:** Tested on Johnathon deployment, ready for use
